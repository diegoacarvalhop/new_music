import{r as n,j as e}from"./react-vendor-CQulTfZ0.js";import{u as $,S as D,g as F,P as M}from"./index-Cs2E90Ho.js";import{M as A}from"./ModalConfirm-BN9a4XRF.js";import"./router-MSaW0Gl8.js";import"./axios-D5GkNzM3.js";function L({instrumento:t,onFechar:o,onSalvo:k}){const{t:r}=$(),[l,j]=n.useState(""),[u,i]=n.useState(""),[h,C]=n.useState(""),[b,f]=n.useState(!0),[v,N]=n.useState(""),[p,I]=n.useState(!1),[c,x]=n.useState(!1),d=!!(t!=null&&t.id);n.useEffect(()=>{t?(j(t.nome||""),i(t.grupoId?String(t.grupoId):""),C(t.descricao||""),f(t.ativo!==!1)):i("")},[t]);function m(a){a.preventDefault(),N(""),x(!1);const P=!l.trim(),E=!u,z=!h.trim();if(P||E||z){N("Preencha os campos obrigatórios."),x(!0);return}I(!0);const S={nome:l,grupoId:Number(u),descricao:h.trim()||void 0,ativo:b},s=F();(d?s.put(`/instrumentos/${t.id}`,S):s.post("/instrumentos",S)).then(()=>k()).catch(g=>{var q,G;return N(((G=(q=g==null?void 0:g.response)==null?void 0:q.data)==null?void 0:G.mensagem)||"Erro ao salvar.")}).finally(()=>I(!1))}return e.jsx("div",{className:"modal-overlay",onClick:o,children:e.jsxs("div",{className:"modal",onClick:a=>a.stopPropagation(),children:[e.jsx("div",{className:"modal-header",children:e.jsx("h2",{children:r(d?"instrumentos.editInstrument":"instrumentos.newInstrumentTitle")})}),e.jsxs("form",{onSubmit:m,className:"modal-body",children:[v&&e.jsx("div",{className:"alert alert-error",children:v}),e.jsxs("div",{className:`form-group ${c&&!u?"field-error":""}`,children:[e.jsx("label",{children:"Grupo *"}),e.jsx(D,{value:u,onChange:a=>i(a),searchUrl:"/grupos",placeholder:"Selecione o grupo",emptyOption:{value:"",label:"Selecione o grupo"},required:!0})]}),e.jsxs("div",{className:`form-group ${c&&!l.trim()?"field-error":""}`,children:[e.jsx("label",{children:"Nome *"}),e.jsx("input",{value:l,onChange:a=>j(a.target.value),required:!0})]}),e.jsxs("div",{className:`form-group ${c&&!h.trim()?"field-error":""}`,children:[e.jsx("label",{children:"Descrição *"}),e.jsx("textarea",{value:h,onChange:a=>C(a.target.value),rows:2,required:!0})]}),e.jsxs("div",{className:"form-group form-group-status",children:[e.jsxs("div",{className:"status-ativo",children:[e.jsx("input",{type:"checkbox",id:"instrumento-ativo",checked:b,onChange:a=>f(a.target.checked),className:"status-checkbox"}),e.jsx("label",{htmlFor:"instrumento-ativo",className:"status-label",children:"Instrumento ativo (aparece nas listas e pode ser vinculado a turmas)"})]}),e.jsx("p",{className:"form-hint",children:"Desmarque para marcar o instrumento como inativo."})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:o,children:r("common.cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:m,disabled:p,children:r(p?"common.saving":"common.save")})]})]})})}function B(){const{t}=$(),[o,k]=n.useState(null),[r,l]=n.useState(0),[j,u]=n.useState(10),[i,h]=n.useState(""),[C,b]=n.useState(!0),[f,v]=n.useState(""),[N,p]=n.useState(!1),[I,c]=n.useState(null),[x,d]=n.useState(null),m=n.useCallback(()=>{b(!0);const s=new URLSearchParams({page:String(r),size:String(j)});i&&s.set("grupoId",i),F().get(`/instrumentos?${s}`).then(y=>k(y.data)).catch(()=>v(t("common.errorLoading"))).finally(()=>b(!1))},[r,j,i]);n.useEffect(()=>m(),[m]);function a(){c(null),p(!0)}function P(s){c(s),p(!0)}function E(){p(!1),c(null),m()}function z(s){d(s)}function w(){x!=null&&F().delete(`/instrumentos/${x}`).then(()=>{d(null),m()}).catch(s=>{var y,g;d(null),v(((g=(y=s==null?void 0:s.response)==null?void 0:y.data)==null?void 0:g.mensagem)||t("common.errorDeleting"))})}const S=(o==null?void 0:o.content)??[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:t("instrumentos.title")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:a,children:t("instrumentos.newInstrument")})]}),e.jsx("div",{className:"busca-wrap",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"filtro-grupo-instrumentos",children:t("instrumentos.group")}),e.jsx(D,{id:"filtro-grupo-instrumentos",value:i,onChange:s=>{h(s),l(0)},searchUrl:"/grupos",placeholder:t("instrumentos.allGroups"),emptyOption:{value:"",label:t("instrumentos.allGroups")},"aria-label":t("instrumentos.filterByGroup")})]})}),f&&e.jsx("div",{className:"alert alert-error",children:f}),C?e.jsx("p",{children:t("common.loading")}):e.jsx("div",{className:"card",children:S.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:t("instrumentos.noInstrumentFound")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:a,children:t("instrumentos.registerInstrument")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrap",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("common.name")}),e.jsx("th",{children:t("instrumentos.group")}),e.jsx("th",{children:t("instrumentos.description")}),e.jsx("th",{children:t("matriculas.active")}),e.jsx("th",{className:"actions-cell",children:t("common.actions")})]})}),e.jsx("tbody",{children:S.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.nome}),e.jsx("td",{children:s.grupoNome||"—"}),e.jsx("td",{children:s.descricao||"—"}),e.jsx("td",{children:s.ativo?e.jsx("span",{className:"badge badge-success",children:t("common.yes")}):e.jsx("span",{className:"badge badge-danger",children:t("common.no")})}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>P(s),children:t("common.edit")}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>z(s.id),children:t("common.delete")})]})]},s.id))})]})}),o&&o.totalPages>0&&e.jsx(M,{page:o.number,totalPages:o.totalPages,totalElements:o.totalElements,size:o.size,onPageChange:l,onSizeChange:s=>{u(s),l(0)}})]})}),N&&e.jsx(L,{instrumento:I,onFechar:E,onSalvo:E}),x!=null&&e.jsx(A,{titulo:t("instrumentos.deleteInstrument"),mensagem:t("instrumentos.deleteInstrumentConfirm"),confirmarTexto:t("common.delete"),cancelarTexto:t("common.cancel"),perigo:!0,onConfirmar:w,onCancelar:()=>d(null)})]})}export{B as default};
