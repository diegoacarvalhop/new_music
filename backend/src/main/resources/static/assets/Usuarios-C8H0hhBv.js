import{r,j as e}from"./react-vendor-CQulTfZ0.js";import{u as M,S as $,g as k,P as z}from"./index-Cs2E90Ho.js";import{a as m,g as L}from"./apiErrors-CU3vO3iu.js";import{b as D,a as q,m as B}from"./validacao-D9FFwnBf.js";import{M as G}from"./ModalConfirm-BN9a4XRF.js";import"./router-MSaW0Gl8.js";import"./axios-D5GkNzM3.js";function H(s,l,h){return s&&l==="PROFESSOR"?[{value:"PROFESSOR",label:h("usuarios.profileProfessor").toUpperCase()}]:[{value:"ADMINISTRADOR",label:h("usuarios.profileAdmin").toUpperCase()},{value:"FUNCIONARIO",label:h("usuarios.profileFuncionario").toUpperCase()}]}function J({usuario:s,onFechar:l,onSalvo:h}){const{t:c}=M(),[d,g]=r.useState(""),[u,f]=r.useState(""),[x,j]=r.useState(""),[R,P]=r.useState("FUNCIONARIO"),[F,N]=r.useState(!0),[O,v]=r.useState(""),[n,U]=r.useState({}),[S,y]=r.useState(!1),[p,b]=r.useState(!1),i=!!(s!=null&&s.id),o=i&&(s==null?void 0:s.perfil)==="PROFESSOR";r.useEffect(()=>{s?(g(s.nome),f(s.email),j(""),P(s.perfil),N(s.ativo??!0)):(g(""),f(""),j(""),P("FUNCIONARIO"),N(!0)),v(""),b(!1)},[s]);function I(){return!(!d.trim()||!u.trim()||!D(u)||!i&&!x.trim())}function T(t){if(t.preventDefault(),b(!0),U({}),!I()){v("Preencha os campos obrigatórios.");return}v(""),y(!0);const C={nome:d.trim(),email:u.trim(),perfil:R,ativo:F};x.trim()&&(C.senha=x.trim()),(i?k().put(`/usuarios/${s.id}`,C):k().post("/usuarios",C)).then(()=>h()).catch(a=>{const{mensagem:E,erros:A}=L(a);v(E),U(A??{})}).finally(()=>y(!1))}return e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:"modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:c(i?"usuarios.editUser":"usuarios.newUserTitle")}),e.jsx("button",{type:"button",className:"modal-close",onClick:l,"aria-label":c("common.closeAria"),children:"×"})]}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"modal-body",children:[O&&e.jsx("div",{className:"alert alert-error",children:O}),e.jsxs("div",{className:`form-group ${p&&!d.trim()||m(n,"nome")?"field-error":""}`,children:[e.jsx("label",{htmlFor:"usuario-nome",children:"Nome *"}),e.jsx("input",{id:"usuario-nome",type:"text",value:d,onChange:t=>g(t.target.value),placeholder:"Nome completo",readOnly:o,disabled:o,className:o?"input-readonly":""}),m(n,"nome")&&e.jsx("span",{className:"field-error-msg",children:m(n,"nome")})]}),e.jsxs("div",{className:`form-group ${p&&(!u.trim()||!D(u))||m(n,"email")?"field-error":""}`,children:[e.jsx("label",{htmlFor:"usuario-email",children:"E-mail *"}),e.jsx("input",{id:"usuario-email",type:"email",value:u,onChange:t=>f(t.target.value),placeholder:"email@exemplo.com",readOnly:o,disabled:o,className:o?"input-readonly":""}),m(n,"email")&&e.jsx("span",{className:"field-error-msg",children:m(n,"email")})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"usuario-professor-cpf",children:"CPF"}),e.jsx("input",{id:"usuario-professor-cpf",type:"text",value:s!=null&&s.professorCpf?q(s.professorCpf):"",readOnly:!0,disabled:!0,className:"input-readonly",placeholder:"—"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"usuario-professor-telefone",children:"Telefone"}),e.jsx("input",{id:"usuario-professor-telefone",type:"text",value:s!=null&&s.professorTelefone?B(s.professorTelefone):"",readOnly:!0,disabled:!0,className:"input-readonly",placeholder:"—"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"usuario-perfil",children:"Perfil *"}),e.jsx($,{id:"usuario-perfil",value:R,onChange:t=>P(t),options:H(i,(s==null?void 0:s.perfil)??"",c).map(t=>({value:t.value,label:t.label})),placeholder:"Selecione o perfil",disabled:o,className:`select-search-wrap--compact${o?" input-readonly":""}`,"aria-label":"Perfil"}),i&&(s==null?void 0:s.perfil)==="PROFESSOR"&&e.jsx("small",{className:"form-hint",children:"Perfil Professor é gerenciado no cadastro de professores."})]}),e.jsxs("div",{className:"form-group form-group-status",children:[e.jsxs("div",{className:"status-ativo",children:[e.jsx("input",{type:"checkbox",id:"usuario-ativo",checked:F,onChange:t=>N(t.target.checked),className:"status-checkbox",disabled:o}),e.jsx("label",{htmlFor:"usuario-ativo",className:"status-label",children:"Usuário ativo (pode acessar o sistema)"})]}),!o&&e.jsx("p",{className:"form-hint",children:"Desmarque para marcar o usuário como inativo."}),o&&e.jsx("p",{className:"form-hint",children:"Para usuário Professor, apenas a senha pode ser alterada aqui. Demais dados são gerenciados no cadastro de professores."})]}),e.jsxs("div",{className:`form-group ${p&&!i&&!x.trim()||m(n,"senha")?"field-error":""}`,children:[e.jsxs("label",{htmlFor:"usuario-senha",children:["Senha ",i?"":"*"]}),e.jsx("input",{id:"usuario-senha",type:"password",value:x,onChange:t=>j(t.target.value),placeholder:i?"Deixe em branco para manter":"Senha"}),m(n,"senha")&&e.jsx("span",{className:"field-error-msg",children:m(n,"senha")})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:l,children:c("common.cancel")}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:S,children:c(S?"common.saving":"common.save")})]})]})]})})}function _(){const{t:s}=M(),[l,h]=r.useState(null),[c,d]=r.useState(0),[g,u]=r.useState(10),[f,x]=r.useState(""),[j,R]=r.useState(""),[P,F]=r.useState(!0),[N,O]=r.useState(""),[v,n]=r.useState(!1),[U,S]=r.useState(null),[y,p]=r.useState(null);r.useEffect(()=>{const a=setTimeout(()=>{x(j),d(0)},300);return()=>clearTimeout(a)},[j]);const b=r.useCallback(()=>{F(!0);const a=new URLSearchParams({page:String(c),size:String(g)});f.trim()&&a.set("busca",f.trim()),k().get(`/usuarios?${a}`).then(E=>h(E.data)).catch(()=>O(s("common.errorLoading"))).finally(()=>F(!1))},[c,g,f]);r.useEffect(()=>b(),[b]);function i(){S(null),n(!0)}function o(a){S(a),n(!0)}function I(){n(!1),S(null),b()}function T(a){p(a)}function t(){y!=null&&k().delete(`/usuarios/${y}`).then(()=>{p(null),b()}).catch(a=>{var E,A;p(null),O(((A=(E=a==null?void 0:a.response)==null?void 0:E.data)==null?void 0:A.mensagem)||s("common.errorDeleting"))})}const C=(l==null?void 0:l.content)??[],w={ADMINISTRADOR:s("usuarios.profileAdmin"),PROFESSOR:s("usuarios.profileProfessor"),FUNCIONARIO:s("usuarios.profileFuncionario")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:s("usuarios.title")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:i,children:s("usuarios.newUser")})]}),N&&e.jsx("div",{className:"alert alert-error",children:N}),e.jsx("div",{className:"busca-wrap",children:e.jsx("input",{type:"search",placeholder:s("common.searchByNameOrEmail"),value:j,onChange:a=>R(a.target.value),"aria-label":s("common.searchByNameOrEmail")})}),P?e.jsx("p",{children:s("common.loading")}):e.jsx("div",{className:"card",children:C.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:s("usuarios.noUserFound")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:i,children:s("usuarios.registerUser")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrap",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("common.name")}),e.jsx("th",{children:s("common.email")}),e.jsx("th",{children:s("usuarios.profile")}),e.jsx("th",{children:s("matriculas.active")}),e.jsx("th",{className:"actions-cell",children:s("common.actions")})]})}),e.jsx("tbody",{children:C.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.nome}),e.jsx("td",{children:a.email}),e.jsx("td",{children:(w[a.perfil]??a.perfil).toUpperCase()}),e.jsx("td",{children:a.ativo?e.jsx("span",{className:"badge badge-success",children:s("common.yes")}):e.jsx("span",{className:"badge badge-danger",children:s("common.no")})}),e.jsxs("td",{className:"actions-cell",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>o(a),children:s("common.edit")}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>T(a.id),children:s("common.delete")})]})]},a.id))})]})}),l&&l.totalPages>0&&e.jsx(z,{page:l.number,totalPages:l.totalPages,totalElements:l.totalElements,size:l.size,onPageChange:d,onSizeChange:a=>{u(a),d(0)}})]})}),v&&e.jsx(J,{usuario:U,onFechar:I,onSalvo:I}),y!=null&&e.jsx(G,{titulo:s("usuarios.deleteUser"),mensagem:s("usuarios.deleteUserConfirm"),confirmarTexto:s("common.delete"),cancelarTexto:s("common.cancel"),perigo:!0,onConfirmar:t,onCancelar:()=>p(null)})]})}export{_ as default};
