import{r as t,j as e}from"./react-vendor-CQulTfZ0.js";import{u as ae,S as U,g as _,a as me,P as xe,M as je}from"./index-Cs2E90Ho.js";import{m as oe,a as ee,b as le,s as q,v as re}from"./validacao-D9FFwnBf.js";import{M as ge}from"./ModalConfirm-BN9a4XRF.js";import"./router-MSaW0Gl8.js";import"./axios-D5GkNzM3.js";const ue=[{value:1,label:"Segunda"},{value:2,label:"Terça"},{value:3,label:"Quarta"},{value:4,label:"Quinta"},{value:5,label:"Sexta"}],ve=[{value:"08:00-09:00",label:"de 8h às 9h"},{value:"09:00-10:00",label:"de 9h às 10h"},{value:"10:00-11:00",label:"de 10h às 11h"},{value:"11:00-12:00",label:"de 11h às 12h"},{value:"13:00-14:00",label:"de 13h às 14h"},{value:"14:00-15:00",label:"de 14h às 15h"},{value:"15:00-16:00",label:"de 15h às 16h"},{value:"16:00-17:00",label:"de 16h às 17h"},{value:"17:00-18:00",label:"de 17h às 18h"},{value:"19:00-20:00",label:"de 19h às 20h"},{value:"20:00-21:00",label:"de 20h às 21h"}],ie={Segunda:1,Terça:2,Quarta:3,Quinta:4,Sexta:5};function Ne(a){if(!a||!a.trim())return[];const r=[],m=a.split(",").map(n=>n.trim()).filter(Boolean);for(const n of m){const d=n.match(/^(\d+)-(\d{1,2}:\d{2})-(\d{1,2}:\d{2})$/);if(d){r.push({diaSemana:Number(d[1]),horario:`${d[2]}-${d[3]}`});continue}const j=n.match(/^(\d+)-(\d{1,2}:\d{2})$/);if(j){const f=j[2],[b]=f.split(":").map(Number),h=`${String(b+1).padStart(2,"0")}:00`;r.push({diaSemana:Number(j[1]),horario:`${f}-${h}`});continue}const i=n.match(/^(Segunda|Terça|Quarta|Quinta|Sexta)\s+(\d{1,2})h(?:\d{2})?$/);if(i&&ie[i[1]]!=null){const f=i[2].padStart(2,"0"),b=`${String(parseInt(f,10)+1).padStart(2,"0")}:00`;r.push({diaSemana:ie[i[1]],horario:`${f}:00-${b}`})}}return r}function Se(a){const r=ue.find(n=>n.value===a.diaSemana),m=r?r.label:`Dia ${a.diaSemana}`;if(a.horario.includes("-")){const[n,d]=a.horario.split("-");return`${m} ${n.replace(":","h")} às ${d.replace(":","h")}`}return`${m} ${a.horario.replace(":","h")}`}function Ce(a){return a.length?a.map(r=>`${r.diaSemana}-${r.horario}`).join(","):""}function ye({professor:a,onFechar:r,onSalvo:m}){const{t:n}=ae(),[d,j]=t.useState(""),[i,f]=t.useState(""),[b,h]=t.useState(""),[x,A]=t.useState(""),[v,O]=t.useState(""),[y,N]=t.useState(""),[P,E]=t.useState(""),[p,$]=t.useState([]),[l,S]=t.useState([]),[c,k]=t.useState(1),[D,z]=t.useState("08:00-09:00"),[T,F]=t.useState(!0),[w,G]=t.useState(""),[R,H]=t.useState(""),[Q,B]=t.useState(!1),[M,Y]=t.useState(!1),L=!!(a!=null&&a.id);t.useEffect(()=>{v||(N(""),E(""))},[v]),t.useEffect(()=>{a?(j(a.nome||""),f(a.email||""),h(a.telefone?oe(a.telefone):""),A(a.cpf?ee(a.cpf):""),S(Ne(a.disponibilidade||"")),F(a.ativo!==!1),a.instrumentos?$(a.instrumentos.split(",").map(s=>s.trim()).filter(Boolean)):$([])):($([]),S([]))},[a]);function X(s){var I;(I=s==null?void 0:s.preventDefault)==null||I.call(s);const u=y===""?null:Number(y);u==null||u===0||!(P!=null&&P.trim())||p.some(g=>g===P.trim())||($(g=>[...g,P.trim()]),N(""),E(""))}function J(s){$(u=>u.filter(I=>I!==s))}function K(s){var I;(I=s==null?void 0:s.preventDefault)==null||I.call(s);const u=`${c}-${D}`;l.some(g=>`${g.diaSemana}-${g.horario}`===u)||S(g=>[...g,{diaSemana:Number(c),horario:D}])}const V=ve;function o(s){S(u=>u.filter((I,g)=>g!==s))}function C(s){s.preventDefault(),H(""),Y(!1);const u=!d.trim(),I=!i.trim(),g=!!i.trim()&&!le(i),he=!!(x&&q(x).length>0&&!re(x)),pe=!L&&!w.trim(),fe=p.length===0,be=l.length===0;if(u||I||g||he||pe||fe||be){H("Preencha os campos obrigatórios."),Y(!0);return}B(!0);const W={nome:d,email:i,telefone:q(b)||void 0,cpf:q(x)||void 0,instrumentos:p.length?p.join(", "):void 0,disponibilidade:Ce(l)||void 0,ativo:T};!L&&w&&(W.senha=w);const se=_();(L?se.put(`/professores/${a.id}`,W):se.post("/professores",W)).then(()=>m()).catch(Z=>{var te,ne;return H(((ne=(te=Z==null?void 0:Z.response)==null?void 0:te.data)==null?void 0:ne.mensagem)||"Erro ao salvar.")}).finally(()=>B(!1))}return e.jsx("div",{className:"modal-overlay",onClick:r,children:e.jsxs("div",{className:"modal",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"modal-header",children:e.jsx("h2",{children:n(L?"professores.editProfessor":"professores.newProfessorTitle")})}),e.jsxs("form",{onSubmit:C,className:"modal-body",children:[R&&e.jsx("div",{className:"alert alert-error",children:R}),e.jsxs("div",{className:`form-group ${M&&!d.trim()?"field-error":""}`,children:[e.jsx("label",{children:"Nome *"}),e.jsx("input",{value:d,onChange:s=>j(s.target.value),required:!0})]}),e.jsxs("div",{className:`form-group ${M&&(!i.trim()||i.trim()&&!le(i))?"field-error":""}`,children:[e.jsx("label",{children:"E-mail *"}),e.jsx("input",{type:"email",value:i,onChange:s=>f(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:`form-group ${M&&x&&q(x).length>0&&!re(x)?"field-error":""}`,children:[e.jsx("label",{children:"CPF"}),e.jsx("input",{value:x,onChange:s=>A(ee(s.target.value)),placeholder:"000.000.000-00",maxLength:14})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Telefone"}),e.jsx("input",{value:b,onChange:s=>h(oe(s.target.value)),placeholder:"(00) 00000-0000"})]})]}),e.jsxs("div",{className:`form-group ${M&&p.length===0?"field-error":""}`,children:[e.jsx("label",{children:"Instrumentos que leciona *"}),e.jsx("p",{className:"form-hint",children:"Você pode adicionar mais de um grupo/instrumento."}),e.jsxs("div",{className:"form-row form-row-inline",children:[e.jsxs("div",{className:"form-group form-group-inline",children:[e.jsx("label",{className:"small",children:"Grupo"}),e.jsx(U,{value:v,onChange:s=>O(s),searchUrl:"/grupos",placeholder:"Selecione o grupo",emptyOption:{value:"",label:"Selecione o grupo"}})]}),e.jsxs("div",{className:"form-group form-group-inline",children:[e.jsx("label",{className:"small",children:"Instrumento"}),e.jsx(U,{value:y,onChange:(s,u)=>{N(s),E(u??"")},searchUrl:"/instrumentos",extraParams:v?{grupoId:v}:{},disabled:!v,placeholder:"Selecione",emptyOption:{value:"",label:"Selecione"}})]}),e.jsxs("button",{type:"button",className:"btn-add-instrumento",onClick:X,disabled:!y,title:"Adicionar instrumento",children:[e.jsx("span",{className:"btn-add-icon",children:"+"}),e.jsx("span",{className:"btn-add-label",children:"Adicionar instrumento"})]})]}),p.length>0&&e.jsx("ul",{className:"lista-tags",style:{marginTop:"0.5rem"},children:p.map(s=>e.jsxs("li",{className:"tag-item",children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",className:"btn btn-outline btn-sm",onClick:()=>J(s),children:"×"})]},s))})]}),e.jsxs("div",{className:`form-group ${M&&l.length===0?"field-error":""}`,children:[e.jsx("label",{children:"Disponibilidade (dias e horários) *"}),e.jsx("p",{className:"form-hint",children:"Selecione um ou mais dias e horários em que está disponível."}),e.jsxs("div",{className:"form-row form-row-inline",children:[e.jsxs("div",{className:"form-group form-group-inline",children:[e.jsx("label",{className:"small",children:"Dia"}),e.jsx(U,{value:String(c),onChange:s=>k(Number(s)||1),options:ue.map(s=>({value:String(s.value),label:s.label})),placeholder:"Dia","aria-label":"Dia",className:"select-search-wrap--compact"})]}),e.jsxs("div",{className:"form-group form-group-inline",children:[e.jsx("label",{className:"small",children:"Horário"}),e.jsx(U,{value:D,onChange:s=>z(s),options:V.map(s=>({value:s.value,label:s.label})),placeholder:"Horário","aria-label":"Horário",className:"select-search-wrap--compact"})]}),e.jsxs("button",{type:"button",className:"btn-add-instrumento",onClick:K,title:"Adicionar horário",children:[e.jsx("span",{className:"btn-add-icon",children:"+"}),e.jsx("span",{className:"btn-add-label",children:"Adicionar horário"})]})]}),l.length>0&&e.jsx("ul",{className:"lista-tags lista-horarios",style:{marginTop:"0.5rem"},children:l.map((s,u)=>e.jsxs("li",{className:"tag-item",children:[e.jsx("span",{children:Se(s)}),e.jsx("button",{type:"button",className:"btn btn-outline btn-sm",onClick:()=>o(u),children:"×"})]},`${s.diaSemana}-${s.horario}-${u}`))})]}),e.jsxs("div",{className:"form-group form-group-status",children:[e.jsxs("div",{className:"status-ativo",children:[e.jsx("input",{type:"checkbox",id:"professor-ativo",checked:T,onChange:s=>F(s.target.checked),className:"status-checkbox"}),e.jsx("label",{htmlFor:"professor-ativo",className:"status-label",children:"Professor ativo (pode lecionar e acessar o sistema)"})]}),e.jsx("p",{className:"form-hint",children:"Desmarque para marcar o professor como inativo."})]}),!L&&e.jsxs("div",{className:`form-group ${M&&!w.trim()?"field-error":""}`,children:[e.jsx("label",{htmlFor:"professor-senha",children:"Senha *"}),e.jsx("input",{id:"professor-senha",type:"password",value:w,onChange:s=>G(s.target.value),autoComplete:"new-password",required:!0,placeholder:"Senha para login no sistema"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:r,children:n("common.cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:C,disabled:Q,children:n(Q?"common.saving":"common.save")})]})]})})}function Pe(a){var m,n;return a?(typeof a=="string"?a:((n=(m=a.toISOString)==null?void 0:m.call(a))==null?void 0:n.slice(0,10))??"").slice(0,10):""}function ce(){const a=new Date;return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`}function $e({professor:a,onFechar:r,onSalvo:m}){const{t:n}=ae(),{user:d}=me(),j=(d==null?void 0:d.perfil)==="ADMINISTRADOR",[i,f]=t.useState(()=>ce()),[b,h]=t.useState([]),[x,A]=t.useState(!1),[v,O]=t.useState(!0),[y,N]=t.useState("");t.useEffect(()=>{!(a!=null&&a.id)||!i||(O(!0),N(""),_().get(`/professores/${a.id}/presencas`,{params:{data:i}}).then(l=>h(l.data||[])).catch(()=>{h([]),N("Erro ao carregar lista de chamada.")}).finally(()=>O(!1)))},[a==null?void 0:a.id,i]);function P(l){h(S=>S.map(c=>c.turmaId===l?{...c,presente:!c.presente}:c))}function E(l){if(l.preventDefault(),!(a!=null&&a.id))return;N(""),A(!0);const S={dataAula:i,registros:b.map(c=>({turmaId:c.turmaId,presente:c.presente!==!1}))};_().post(`/professores/${a.id}/presencas`,S).then(()=>m==null?void 0:m()).catch(c=>{var k,D;return N(((D=(k=c==null?void 0:c.response)==null?void 0:k.data)==null?void 0:D.mensagem)||"Erro ao salvar chamada.")}).finally(()=>A(!1))}if(!a)return null;const p=ce(),$=i>p;return j?e.jsx("div",{className:"modal-overlay",onClick:r,children:e.jsxs("div",{className:"modal modal-chamada",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h2",{children:["Chamada do professor — ",a.nome]})}),e.jsxs("form",{onSubmit:E,className:"modal-body",children:[y&&e.jsx("div",{className:"alert alert-error",children:y}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Data da aula *"}),e.jsx("input",{type:"date",value:Pe(i),onChange:l=>f(l.target.value),placeholder:"DD/MM/AAAA",max:p,required:!0})]})}),$?e.jsx("p",{className:"empty-state",children:"Não é possível fazer chamada em data futura. Selecione uma data até hoje."}):v?e.jsx("p",{children:"Carregando aulas do dia..."}):b.length===0?e.jsx("p",{className:"empty-state",children:"Nenhuma aula deste professor nesta data (verifique o dia da semana)."}):e.jsxs("div",{className:"chamada-lista",children:[e.jsx("p",{className:"form-hint",children:"Marque presença ou falta do professor em cada turma/aula."}),e.jsx("ul",{children:b.map(l=>e.jsx("li",{className:"chamada-item",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:l.presente!==!1,onChange:()=>P(l.turmaId),disabled:!j}),e.jsx("span",{className:l.presente===!1?"falta":"",children:l.turmaDescricao??`Turma ${l.turmaId}`})]})},l.turmaId))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:r,children:n("common.cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:E,disabled:x||v||$||b.length===0,children:n(x?"common.saving":"common.saveAttendance")})]})]})}):e.jsx("div",{className:"modal-overlay",onClick:r,children:e.jsxs("div",{className:"modal modal-chamada",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h2",{children:["Chamada do professor — ",a.nome]})}),e.jsx("div",{className:"modal-body",children:e.jsx("p",{className:"empty-state",children:"Apenas o administrador pode realizar a chamada do professor."})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-outline",onClick:r,children:n("common.close")})})]})})}function de(a){const r=a.trim();return r.length?/^[\d.\s-]*$/.test(r)&&q(r).length>0:!1}function Fe(){const{t:a}=ae(),{user:r}=me(),m=(r==null?void 0:r.perfil)==="ADMINISTRADOR",[n,d]=t.useState(null),[j,i]=t.useState(0),[f,b]=t.useState(10),[h,x]=t.useState(""),[A,v]=t.useState(""),[O,y]=t.useState(!0);t.useEffect(()=>{const o=setTimeout(()=>{x(A),i(0)},300);return()=>clearTimeout(o)},[A]);const[N,P]=t.useState(""),[E,p]=t.useState(!1),[$,l]=t.useState(null),[S,c]=t.useState(null),[k,D]=t.useState(null),[z,T]=t.useState(null),F=t.useCallback(()=>{y(!0);const o=new URLSearchParams({page:String(j),size:String(f)});h.trim()&&o.set("busca",de(h)?q(h):h.trim()),_().get(`/professores?${o}`).then(C=>d(C.data)).catch(()=>P(a("common.errorLoading"))).finally(()=>y(!1))},[j,f,h]);t.useEffect(()=>F(),[F]);function w(){l(null),p(!0)}function G(o){l(o),p(!0)}function R(){p(!1),l(null),F()}function H(o){c(o)}function Q(){c(null)}function B(o){D(o)}function M(){D(null)}const Y=new Date,L=Y.getFullYear(),X=Y.getMonth()+1;function J(o){T(o)}function K(){z!=null&&_().delete(`/professores/${z}`).then(()=>{T(null),F()}).catch(o=>{var C,s;T(null),P(((s=(C=o==null?void 0:o.response)==null?void 0:C.data)==null?void 0:s.mensagem)||a("common.errorDeleting"))})}const V=(n==null?void 0:n.content)??[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:a("professores.title")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:w,children:a("professores.newProfessor")})]}),N&&e.jsx("div",{className:"alert alert-error",children:N}),e.jsx("div",{className:"busca-wrap",children:e.jsx("input",{type:"search",placeholder:a("professores.searchPlaceholder"),value:A,onChange:o=>{const C=o.target.value;v(de(C)?ee(C):C)},"aria-label":a("professores.searchPlaceholder")})}),O?e.jsx("p",{children:a("common.loading")}):e.jsx("div",{className:"card",children:V.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:a("professores.noProfessorFound")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:w,children:a("professores.registerProfessor")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrap",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a("common.name")}),e.jsx("th",{children:a("common.email")}),e.jsx("th",{children:a("nav.instrumentos")}),e.jsx("th",{children:a("matriculas.active")}),e.jsx("th",{className:"actions-cell",children:a("common.actions")})]})}),e.jsx("tbody",{children:V.map(o=>e.jsxs("tr",{children:[e.jsx("td",{children:o.nome}),e.jsx("td",{children:o.email}),e.jsx("td",{children:o.instrumentos||"—"}),e.jsx("td",{children:o.ativo?e.jsx("span",{className:"badge badge-success",children:a("common.yes")}):e.jsx("span",{className:"badge badge-danger",children:a("common.no")})}),e.jsxs("td",{className:"actions-cell",children:[m&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>H(o),children:a("professores.attendance")}),e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>B(o),children:a("professores.viewPresencasFaltas")})]}),e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>G(o),children:a("common.edit")}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>J(o.id),children:a("common.delete")})]})]},o.id))})]})}),n&&n.totalPages>0&&e.jsx(xe,{page:n.number,totalPages:n.totalPages,totalElements:n.totalElements,size:n.size,onPageChange:i,onSizeChange:o=>{b(o),i(0)}})]})}),E&&e.jsx(ye,{professor:$,onFechar:R,onSalvo:R}),S&&e.jsx($e,{professor:S,onFechar:Q,onSalvo:Q}),k&&e.jsx(je,{professorId:k.id,professorNome:k.nome,ano:L,mes:X,podeAlterar:m,onFechar:M}),z!=null&&e.jsx(ge,{titulo:a("professores.deleteProfessor"),mensagem:a("professores.deleteProfessorConfirm"),confirmarTexto:a("common.delete"),cancelarTexto:a("common.cancel"),perigo:!0,onConfirmar:K,onCancelar:()=>T(null)})]})}export{Fe as default};
